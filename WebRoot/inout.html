<!DOCTYPE html>
<html>
  <head>
    <title>车辆管理</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <link href="bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="http://cdn.bootcss.com/html5shiv/3.7.0/html5shiv.min.js"></script>
        <script src="http://cdn.bootcss.com/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
    <link href="css/jBootsrapPage.css" rel="stylesheet"/>
    <link href="css/fineuploader.css" rel="stylesheet"/>
    <link href="css/datepicker.css" rel="stylesheet"/>
    
    <link href="css/base.css" rel="stylesheet">
	<link href="css/main.css" rel="stylesheet">
  </head>
  <body>
<!-- <div class="container">
    <div class="row top">
    	<div class="span1"></div>
    	<div class="span10">
        <div class="row headimg">
        <div class="span6 top30"><a href="" id="logo"><img src="images/logo.png" class="logoimg"/></a></div>
        <div class="span4 topb">
           <div class="navbar">
           	    <div class="">
		           	  <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
				        <span class="icon-bar"></span>
				        <span class="icon-bar"></span>
				        <span class="icon-bar"></span>
				      </a>
				      <div class="nav-collapse collapse">
				        <ul class="nav">					   
					      <li class="current" id="crgl"><a href="" id="crli">出入管理</a></li>
					      <li id="clgl"><a href="" id="clli">车辆管理</a></li>
					    </ul>
					    <ul class="nav pull-right">
					      <li><a><img src="" id="userimg"/></a></li>
					      <li><a id="username"></a></li>
					    </ul>
				      </div>
			  </div>
			</div>
        </div>
   		</div>
   		</div>
   		<div class="span1"></div>
    </div>
    <div class="row">
		 <div class="span12 thumbnail noborder">
				<div class="flash">
					<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,19,0"  width="1050" height="405" align="center">
						<param name="movie" value="flash/index.swf">
						<param name="quality" value="high">
						<param name="wmode" value="transparent">
						<embed src="flash/index.swf"  wmode="transparent"  width="1050" height="405" align="center" quality="high" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash"></embed>
					</object>
				</div>
		 </div>
    </div>
    
    <div class="row">
    		<div class="span1"></div>
		    <div class="span10">
		    <div class="navbar">
			    <div class="navbar-inner">
			        <ul class="nav">			            
			            <li id="clgl"><a href="" id="clli">车辆管理</a></li>
			            <li class="active"  id="crgl"><a  href="" id="crli">出入管理</a></li>
			        </ul>
			     </div>   
			</div>
		    </div>
		    <div class="span1"></div>
    </div>
    
    <div class="row" id="signalcontent">
    	<div class="span1"></div>
		 <div class="span10">
	 	    <div class="row">
	 	    	<div class="span10 h40"></div>
				 <div class="span10">
				 	<div class="row">
				 		<div class="span10">
					 		<div class="left"><h4>出入统计</h4></div>
							<div class="right">
								<table>
								<tr>
								<td>从&nbsp;</td>
								<td>
									<div class="input-append date datetop" id="date" data-date="" data-date-format="yyyy-mm-dd">
									    <input class="span2" size="16" type="text" value="" readonly>
									    <span class="add-on"><i class="icon-calendar"></i></span>
									</div>
								</td>
								<td>&nbsp;至&nbsp;</td>
								<td>
									<div class="input-append date datetop" id="outdate" data-date="" data-date-format="yyyy-mm-dd">
									    <input class="span2" size="16" type="text" value="" readonly>
									    <span class="add-on"><i class="icon-calendar"></i></span>
									</div>
								</td>
								<td>
								<button id="signalbutton" class="btn btn-warning"><i class="icon-signal"></i>统计</button>								
								</td>
								</tr>
								</table>							
							</div>
							<table class="table table-striped table-bordered table-hover" id="signal"></table>
				 		</div>
				 		<div class="span10 h5"></div>
				 			<div class="span10">
					 		<div class="left"><h4>出入详情</h4></div>					 	
				 		</div>
				 		<div class="span10">
				 		<ul class="nav nav-tabs" id="litab">
					        <li class="active"><a href="javascript:void(0)">进入</a></li>
					        <li><a href="javascript:void(0)">离开</a></li>
					    </ul>
			 			<table class="table table-striped table-bordered table-hover" id="cartable"></table>
			 			<ul class="pagination"></ul>
				 		</div>
				 	</div>
				 </div>
		    </div>
		 </div>
		 <div class="span1"></div>
    </div>
</div>

                  	<div class="footer">
		<div class="footerCon">
			<div class="copyright">
				<p>版权所有：无锡旅游商贸高等职业技术学校   COPYRIGHT © 2010 ALL RIGHTS RESERVED </p>
				<p>地址：无锡市广石路999号 <span>电话：0510-83116678</span>    <span> 苏ICP备:09007163</span>技术支持：南京第五十五所技术开发有限公司</p>
			</div>
			<div class="logobottom">
				<img src="images/logobottom.gif"/>
			</div>
			<div class="clear"></div>
		</div>
	</div> -->
	
	<div>
		<div class="contentwrap">

			<div class="top" style="height:30px;>
				<div class="header png_bg">
					<!-- <div class="logo"><a href="" id="logo"><img src="images/logo.png"/></a></div> -->
					<!-- <div class="login"> 						
					   <div class="loginwrap">
							<div class="inputwrap">
								<a><img src="" id="userimg"  width="50px"/></a>
								<a id="username"></a>
							</div>
						</div>
					</div> -->
					<!-- <div class="clear"></div> -->
					<div class="dhlnav menu" id="nav">
						<ul class="dhlnav">			            
				            <li id="clgl"><a href="" id="clli">车辆管理</a></li>
				            <li class="dhlactive" id="crgl"><a  href="" id="crli">出入管理</a></li>
				            <li id="dcgl"><a id="dcli">停车场管理</a></li>
				            <li id="ledgl"><a id="ledli">显示屏管理</a></li>
			        	</ul>
						<div class="clear"></div>
					</div>
				</div>

			<!-- 	<div class="flash">
					<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,19,0"  width="1050" height="405" align="center">
						<param name="movie" value="flash/index.swf">
						<param name="quality" value="high">
						<param name="wmode" value="transparent">
						<embed src="flash/index.swf"  wmode="transparent"  width="1050" height="405" align="center" quality="high" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash"></embed>
					</object>
				</div> -->
			</div>
			<div class="conmain  png_bg">
				<div class="contentTop">
					<!-- <div class="contentTopLeft">
						<div id="scrollWrap"> 
							<ul id="scrollMsg"> 
								<li><a class="msgtip" href="#">出入管理</a></li>
							</ul>
						</div>
					</div> -->
					<div class="clear"></div>
				</div>
				<div class="h10"></div>
		 		<div class="copyright"><h1>出入统计</h1></div>
				<div class="logobottom">
					<table>
					<tr>
					<td>从&nbsp;</td>
					<td>
						<div class="input-append date dhltablediv" id="date" data-date="" data-date-format="yyyy-mm-dd">
						    <input class="span2" size="16" type="text" value="" readonly>
						    <span class="add-on"><i class="icon-calendar"></i></span>
						</div>
					</td>
					<td>&nbsp;至&nbsp;</td>
					<td>
						<div class="input-append date dhltablediv" id="outdate" data-date="" data-date-format="yyyy-mm-dd">
						    <input class="span2" size="16" type="text" value="" readonly>
						    <span class="add-on"><i class="icon-calendar"></i></span>
						</div>
					</td>
					<td>&nbsp;&nbsp;</td>
					<td>
					<button id="signalbutton" class="btn btn-warning"><i class="icon-signal"></i>统计</button>								
					</td>
					</tr>
					</table>							
				</div>
				<table class="table table-striped table-bordered table-hover" id="signal"></table>
				<div class="clear"></div>
				<div class="copyright"><h1>出入详情</h1></div>	
				<div class="clear"></div>
				<ul class="nav nav-tabs" id="litab">
					        <li class="active"><a href="javascript:void(0)">进入</a></li>
					        <li><a href="javascript:void(0)">离开</a></li>
					    </ul>
			 			<table class="table table-striped table-bordered table-hover" id="cartable"></table>
			 			<ul class="pagination"></ul>
			</div>
		</div>
	<!-- <div class="footer">
		<div class="footerCon">
			<div class="copyright">
				<p>版权所有：无锡旅游商贸高等职业技术学校   COPYRIGHT © 2010 ALL RIGHTS RESERVED </p>
				<p>地址：无锡市广石路999号 <span>电话：0510-83116678</span>    <span> 苏ICP备:09007163</span>技术支持：南京第五十五所技术开发有限公司</p>
			</div>
			<div class="logobottom">
				<img src="images/logobottom.gif"/>
			</div>
			<div class="clear"></div>
		</div>
	</div> -->
	
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="bootstrap/js/jquery-1.9.1.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <script src="js/jBootstrapPage.js"></script>
    <script src="js/fineuploader.js"></script>
    <script src="js/bootstrap-datepicker.js" ></script>
    <script src="js/common.js" ></script>
    <script>
	    $(document).ready(function(){
			var date = CurentTime();
			$('#date').attr("data-date",date);
			$('#date input').attr("value",date);
			$('#date').datepicker();		
			
			$('#outdate').attr("data-date",date);
			$('#outdate input').attr("value",date);
			$('#outdate').datepicker();	
			
			var array = parseUrl();
	    	var b = array[0];
	    	
	    	if ("admin" == b)
	    	{	    	
		    	$("#logo").attr("href","/carplat/");
	    		$("#crli").attr("href","/carplat/inout.html");
	    		$("#clli").attr("href","/carplat/");	 	    
	    		$("#dcli").attr("href","/carplat/parking.html");
	    		$("#ledli").attr("href","/carplat/led.html");
		    	$("#username").html("管理员");	    	
		    	$("#userimg").attr("src","images/user.png");
	    	}
	    	else
	    	{
		    	var role = array[1];		    	
		    	$("#logo").attr("href","/carplat/index.html?"+b);
	    		$("#crli").attr("href","/carplat/inout.html?"+b);
	    		$("#clli").attr("href","/carplat/index.html?"+b);	
	    		$("#dcli").attr("href","/carplat/parking.html?"+b);
	    		$("#ledli").attr("href","/carplat/led.html?"+b);
	    		if (role == 0)
		    	{
		    		$("#crgl").show();
		    	}
		    	else// if (role == 1)
		    	{		    		
		    		$("#crgl").hide();
		    	}   
		    	//管理员
		    	/* if (role == 1)//教师
		    	{	    		
		    		$("#signalcontent").hide();
					$("#footer").hide();
		    	}	
		    	else if (role == 2)
		    	{
		    		$("#signalcontent").hide();
					$("#footer").hide();	
					$("#clgl").hide();
		    	} */
		    	var username = array[2];
		    	$("#username").html(username);	    	
		    	$("#userimg").attr("src",array[3]);
	    	}
	    	
	    	initCar(1);
			initCount();
			$("#signalbutton").click(function(){
				var flag = checkdate();
				if (flag)
				{
					initCar(1);
					initCount();	
				}				
			});
			
			$("#litab li").click(function(){
				$(".active").removeClass("active");
				$(this).addClass("active");
				initCar(1);
			});
			setInterval(queryHandle,60000);
		});
	    function checkdate()
	    {   
	    	var indate = $('#date input').val();
	    	var outdate = $('#outdate input').val();
	        var sDate = new Date(indate.replace(/\-/g, "\/"));
	     	var eDate = new Date(outdate.replace(/\-/g, "\/"));
	    	if(sDate > eDate)
	     	{
	     	 	alert("结束日期不能小于开始日期");
	      		return false;
	     	}
	     	return true;
	    }
	    function queryHandle(){  
	    	initCar(1);
			initCount();
	    }  
	    function initCount()
	    {
	    	var indate = $('#date input').val();
	    	var outdate = $('#outdate input').val();
	    	$.ajax({				
				url:"carInOutCount.action?indate="+indate+"&outdate="+outdate,
				type:"post",
				success:function(s){
					var a=eval("("+s+")");
					if (a)
					{						
						var t = '<tr><th></th><th>前门进入车辆</th><th>后门进入车辆</th><th>前门离开车辆</th><th>后门离开车辆</th></tr>';
						for(var i=0;i<a.rows.length;i++){
								var b = a.rows[i];
			    				t += '<tr><td>'+b.count1+'</td><td>'+b.count2+'</td><td>'+b.count3+'</td><td>'+b.count4+'</td><td>'+b.count5+'</td></tr>';
							}							
						$("#signal").html(t);		
					}
				}
				});
	    }
	    function CurentTime()
	    { 
	        var now = new Date();
	        var year = now.getFullYear();       //年
	        var month = now.getMonth() + 1;     //月
	        var day = now.getDate();            //日
	        //var hh = now.getHours();            //时
	        //var mm = now.getMinutes();          //分
	        var clock= year + "-";
	        if(month < 10)
	            clock += "0";
	        clock += month + "-";
	        if(day < 10)
	            clock += "0";
	        clock += day;
	        //clock += year;
	        /*if(hh < 10)
	            clock += "0";
	        clock += hh + ":";
	        if (mm < 10) clock += '0'; 
	        clock += mm;*/ 
	        return(clock); 
	    } 
	    function createPage(pageSize, buttons, total) {
            $(".pagination").jBootstrapPage({
                pageSize : pageSize,
                total : total,
                maxPageButton:buttons,
                onPageClicked: function(obj, pageIndex) {
                  var pindex = pageIndex+1;
                  initCar(pindex);
                }
            });
        }
	    function initCar(pindex)
	    {
	    	var indate = $('#date input').val();
	    	var outdate = $('#outdate input').val();
	    	//alert(indate);
	    	var litext = $(".active a").html();
	    	
	    	var status = 0;
	    	if (litext == '离开')
    		{
	    		status = 1;
    		}
	    	$.ajax({				
				url:"carInOut.action?pindex="+pindex+"&indate="+indate+"&status="+status+"&outdate="+outdate,
				type:"post",
				success:function(s){
					var a=eval("("+s+")");
					if (a)
					{						
						var t = '<tr><th>编号</th><th>车牌</th><th>进入时间</th><th>进入位置</th><th>车主</th><th>联系方式</th><th>车位状态</th><th>是否迟到</th></tr>';
						if (status == 1)
						{
							t = '<tr><th>编号</th><th>车牌</th><th>离开时间</th><th>离开位置</th><th>车主</th><th>联系方式</th><th>车位状态</th><th>是否迟到</th></tr>';
						}
						for(var i=0;i<a.rows.length;i++){
								var b = a.rows[i];
			    				t += '<tr><td>'+b.code+'</td><td>'+b.card+'</td><td>'+b.indate+'</td><td>'+b.status+'</td><td>'+b.caruser+'</td><td>'+b.tel+'</td><td>'+b.alldate+'</td><td>'+b.time+'</td></tr>';
							}							
						$("#cartable").html(t);
						
						//分页
						if (pindex == 1)
						createPage(10,5,a.total);
					
					}
				}
				});
	    }
    </script>
  </body>
</html>


